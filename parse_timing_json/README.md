## 用法

`python parse_timing_json.py raw_timing.json raw.txt`

这条命令生成一个名为"raw_timing.json.out.json"的文件。

开源软件long-audio-align根据音频和对应的文本，可以自动识别文本的时间（单词级别）。比如：

原文
> All of a sudden then, I wanted to get the hell out of the room. I could feel a terrific lecture coming on. I didn't mind the idea so much, but I didn't feel like being lectured to and

输出到终端：
all(421.51202,421.57187) a(421.57187,421.67166) sudden(421.7315,422.37006) i(422.37006,422.59955) wanted(422.84897,423.16824) to(423.21814,423.717) get(423.74695,424.5651) hell(424.5651,424.7746) of(425.4331,425.49298) the(425.49298,425.62268) room(425.62268,425.86212) i(426.02176,426.1016) could(426.4608,426.70023) a(426.70023,427.13922) lecture(427.239,427.60815) coming(427.60815,428.01724) on(428.04718,428.41632) didnt(428.4762,428.7755) mind(428.7755,429.00497) idea(429.74332,430.34195) so(430.39185,430.61133) much(430.65125,430.78094) but(430.78094,430.9805) i(430.9805,431.1102) didnt(431.18005,431.5492) feel(431.5492,431.91837) being(432.00815,432.8762) to(433.06577,433.20544) and(433.20544,1143.9801)

同时进一步处理得到的json文件：
生产的json文件

[
"all", 
421.51202, 
421.57187
], 
[
"a", 
421.57187, 
421.67166
], 
[
"sudden", 
421.7315, 
422.37006
], 
[
"i", 
422.37006, 
422.59955
], 
[
"wanted", 
422.84897, 
423.16824
], 
[
"to", 
423.21814, 
423.717
], 


**但是，long-audio-align输出的包含时间的文本是有缺陷的：无标点符号（包括段落分隔符）；错字（youre, dont, isnt之类的由于'缺失导致的错误）；漏字。**

于是我写了一个python脚本：parse_timing_json.py，它比较原文和long-audio-align输出的json文件，把原文未被识别的文本插入到json文件中，得到**一个包含完整文本和时间的json文件**：

[
". All", 
421.51202
], 
[
"of a", 
421.57187
], 
[
"sudden", 
421.7315
], 
[
"then, I", 
422.37006
], 
[
"wanted", 
422.84897
], 
[
"to", 
423.21814
], 
[
"get", 
423.74695
], 
[
"the hell", 
424.5651
], 
[
"out of", 
425.4331
], 
[
"the", 
425.49298
], 

但是，这个脚本容错性非常不好，或者说，对输入文件非常挑剔，输入json文件漏字不能太多，和txt文件必须几乎一致，这个脚本才可以把时间戳和原文做匹配。
幸运的是，long-audio-align产生的json文件可以满足。


## parse_new_line.py

### 处理换行符
如果json文件中的字符串包含换行符，则以换行符为界拆分字符串，换行符单独拿出来。目的是方便app处理换行：app读取到换行符后，使其占据整个linearlayout，使app所显示的文本段落结构更加清晰。

### 处理超过行宽的字符串
目前app处理timing-json的方法是：读取字符串创建TextView然后添加到LinearLayout，如果string的宽度超过行宽，则添加到下一个行；但是若字符串长度超过行宽，将导致超出部分不被显示。这个脚本的作用是，拆分字符串！


李2
2015-08-18 沪北

